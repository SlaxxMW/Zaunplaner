<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Zaunteam Zaunplaner</title>

  <!-- PWA -->
  <link rel="manifest" href="./manifest.webmanifest">
  <meta name="theme-color" content="#e6e6e6">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="apple-touch-icon" href="./icon-192.png">

  <style>
    :root{
      /* Zaunteam Mid-Dark (kr√§ftig, aber nicht zu dunkel) */
      --bg1:#111827;          /* slate-900 */
      --bg2:#334155;          /* slate-700 */
      --panel:#253247;        /* panel */
      --card:#1f2a3d;         /* card */
      --card2:#22314a;

      --field:#2a3b55;        /* input background */
      --field2:#314766;

      --line:rgba(255,255,255,.16);
      --line2:rgba(122,193,65,.40);

      --txt:#f8fafc;
      --muted:#e2e8f0;

      --green:#7ac141;        /* Zaunteam green */
      --green2:#b7f36b;       /* brighter */
      --red:#e53935;          /* Zaunteam red */
      --red2:#ff6b63;

      --pill:rgba(122,193,65,.22);
      --pill2:rgba(0,166,251,.14);

      --shadow:0 14px 34px rgba(0,0,0,.32);
      --shadow2:0 6px 18px rgba(0,0,0,.24);

      --r:16px;
    }
    *{ box-sizing:border-box; }
    html,body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--txt);
      background:
        radial-gradient(1200px 800px at 10% 0%, rgba(122,193,65,.18), transparent 55%),
        radial-gradient(1000px 700px at 95% 20%, rgba(229,57,53,.12), transparent 55%),
        radial-gradient(900px 650px at 60% 110%, rgba(0,166,251,.12), transparent 60%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
    }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--txt);
      background:
        radial-gradient(900px 420px at 10% 0%, rgba(200,31,54,.10), transparent 60%),
        radial-gradient(900px 420px at 90% 0%, rgba(0,0,0,.08), transparent 60%),
        var(--bg);
    }
    .wrap{ max-width:1160px; margin:0 auto; padding:14px; }

    /* Full-bleed Card (z.B. Zaunabschnitte) ‚Äì bricht aus der max-width aus */
    .fullBleed{
      width: calc(100vw - 28px);
      margin-left: calc(50% - 50vw + 14px);
      margin-right: calc(50% - 50vw + 14px);
    }
    @media (max-width:860px){
      .fullBleed{ width:100%; margin-left:0; margin-right:0; }
    }
    .topbar{
      background:linear-gradient(180deg, rgba(31,42,61,.92), rgba(34,49,74,.86));
      border:1px solid var(--line);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      padding:12px;
      position:relative;
      overflow:hidden;
    }
    /* Zaunteam Stripe */
    .topbar:before{
      content:"";
      position:absolute;
      left:0; right:0; top:0;
      height:6px;
      background:linear-gradient(90deg, var(--green), var(--green2), var(--red), var(--red2));
      opacity:.95;
    }
    .toprow{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .brand{
      font-weight:950;
      letter-spacing:.2px;
      color:var(--green2);
      text-shadow:0 1px 0 rgba(0,0,0,.35);
    }
    .brand small{
      font-weight:800;
      color:rgba(226,232,240,.92);
      font-size:12px;
    }
    .row{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:6px 10px;
      border-radius:999px;
      background:linear-gradient(180deg, rgba(122,193,65,.22), rgba(0,166,251,.10));
      border:1px solid rgba(255,255,255,.14);
      font-size:12px;
      color:var(--txt);
      white-space:nowrap;
    }
    .pill.good{ border-color:#bfe6bf; background:#e9f6e9; color:var(--good); }
    .pill.bad{ border-color:#f2b6c0; background:#fde9ee; color:var(--bad); }
    .pill.accent{ border-color:rgba(200,31,54,.35); background:rgba(200,31,54,.10); color:var(--accent2); }

    .tabs{ display:flex; gap:8px; margin-top:12px; flex-wrap:wrap; }
    .tabBtn{
      border:1px solid rgba(255,255,255,.12);
      background:rgba(17,24,39,.55);
      color:var(--txt);
      padding:9px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:900;
      box-shadow:var(--shadow2);
    }
    .tabBtn:hover{ transform: translateY(-1px); }
    .tabBtn.active{
      background:linear-gradient(180deg, rgba(122,193,65,.35), rgba(122,193,65,.18));
      color:var(--txt);
      border-color:rgba(122,193,65,.65);
      box-shadow:0 0 0 3px rgba(122,193,65,.12), var(--shadow2);
    }

    .panel{
      margin-top:12px;
      background:linear-gradient(180deg, rgba(37,50,71,.92), rgba(31,42,61,.92));
      border:1px solid var(--line);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      padding:14px;
    }
    h2{ margin:0 0 10px; font-size:18px; }
    label{ display:block; font-size:12px; color:rgba(226,232,240,.92); margin:8px 0 4px; }
    .inputBlock{}
    input, select, textarea{
      width:100%;
      padding:10px 10px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:linear-gradient(180deg, var(--field), var(--field2));
      color:var(--txt);
      font-size:14px;
      outline:none;
    }
    input:focus, select:focus, textarea:focus{
      border-color: rgba(200,31,54,.55);
      box-shadow: 0 0 0 4px rgba(200,31,54,.12);
    }
    textarea{ min-height:92px; resize:vertical; }
    .grid2{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    .grid3{ display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px; }
    @media (max-width:860px){ .grid2,.grid3{ grid-template-columns:1fr; } }

    .btn{
      border:1px solid rgba(255,255,255,.12);
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      color:var(--txt);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:950;
      transition:transform .08s ease, box-shadow .12s ease, filter .12s ease;
      box-shadow:var(--shadow2);
    }
    .btn:hover{ filter:brightness(1.06); }
    .btn:active{ transform:translateY(1px); }
    .btn:hover{ filter:brightness(1.02); }
    .btn:active{ transform:translateY(1px); box-shadow:0 2px 8px rgba(2,6,23,.12); }

    .btn:hover{ transform: translateY(-1px); }
    .btn.bad{ border-color:#f2b6c0; color:var(--bad); }
    .ph .btn.bad{ background:rgba(229,57,53,.95); color:#fff; border-color:rgba(229,57,53,.65); box-shadow:0 10px 20px rgba(0,0,0,.35); }
    .ph .btn.bad:hover{ filter:brightness(1.05); }
    .btn.good{ border-color:#bfe6bf; color:var(--good); }
    .btn.accent{ border-color:rgba(200,31,54,.45); background:rgba(200,31,54,.10); }
    .btn.small{ padding:7px 10px; font-size:12px; border-radius:12px; }
    .btn.green{ background:linear-gradient(180deg, rgba(122,193,65,.42), rgba(122,193,65,.18)); border-color:rgba(122,193,65,.70); color:#052e16; }
    .btn.blue{ background:linear-gradient(180deg, rgba(0,166,251,.38), rgba(0,166,251,.14)); border-color:rgba(0,166,251,.60); color:#001a33; }
    .btn.orange{ background:linear-gradient(180deg, rgba(245,158,11,.45), rgba(245,158,11,.16)); border-color:rgba(245,158,11,.70); color:#2a1200; }
    .btn.purple{ background:linear-gradient(180deg, rgba(99,102,241,.40), rgba(99,102,241,.14)); border-color:rgba(99,102,241,.65); color:#0b1026; }
    .btn.dark{ background:linear-gradient(180deg, rgba(229,57,53,.42), rgba(229,57,53,.18)); border-color:rgba(229,57,53,.70); color:#2a0000; }
    .btn.green:hover,.btn.blue:hover,.btn.orange:hover,.btn.purple:hover,.btn.dark:hover{ filter:brightness(1.08); }
    .btn.green:hover,.btn.blue:hover,.btn.orange:hover,.btn.purple:hover,.btn.dark:hover{ filter:brightness(1.04); }


    .hint{ color:rgba(226,232,240,.92); font-size:13px; }

    .card{
      border:1px solid var(--line);
      border-radius:16px;
      padding:12px;
      background:linear-gradient(180deg, rgba(31,42,61,.92), rgba(34,49,74,.92));
      box-shadow:var(--shadow2);
      margin-top:10px;
    }
    .cardTitle{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .meta{ color:rgba(226,232,240,.92); font-size:12px; margin-top:4px; }

    /* Gate UI */
    .gateRow{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr auto;
      gap:10px;
      align-items:end;
      padding:10px;
      border:1px dashed var(--line);
      border-radius:14px;
      margin-top:10px;
      background: linear-gradient(180deg, rgba(31,42,61,.92), rgba(34,49,74,.92));
    }
    .gateAct{ display:flex; gap:8px; }
    @media (max-width:860px){
      .gateRow{ grid-template-columns:1fr; }
      .gateAct{ justify-content:flex-end; }
    }

    /* Fotos */
    #photoGrid{
      display:grid;
      grid-template-columns:repeat(3, 1fr);
      gap:10px;
    }
    @media (max-width:860px){ #photoGrid{ grid-template-columns:repeat(2, 1fr);} }
    .ph{
      border:1px dashed var(--line);
      border-radius:16px;
      padding:10px;
      background:linear-gradient(180deg, rgba(31,42,61,.92), rgba(34,49,74,.92));
      min-height:140px;
      position:relative;
    }
    .ph img{ width:100%; border-radius:14px; display:block; border:1px solid rgba(255,255,255,.14); box-shadow:0 10px 22px rgba(0,0,0,.35); }
    .ph input[type=file]{ width:100%; }
    .ph .cardTitle{ padding:2px 0 4px 0; }
    .ph .meta{ color:rgba(226,232,240,.92); }

    #toast{
      display:none;
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      bottom:18px;
      z-index:9999;
      max-width:min(720px, calc(100% - 22px));
      background:linear-gradient(90deg, rgba(122,193,65,.28), rgba(229,57,53,.22), rgba(0,166,251,.22), rgba(17,24,39,.95));
      color:#fff;
      padding:10px 14px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      box-shadow:0 14px 38px rgba(0,0,0,.45);
      font-weight:900;
      font-size:13px;
    }
  
    /* Dropdown readability (native dropdown lists) */
    select{ color:var(--txt); }
    select option{ background:#f8fafc; color:#0f172a; }
    /* Safari/iOS sometimes uses optgroup */
    optgroup{ background:#f8fafc; color:#0f172a; }

    /* Materialliste kompakt (Chef) */
    #matList details{ border:1px solid var(--line); border-radius:16px; overflow:hidden; background:rgba(255,255,255,.04); }
    #matList summary{ cursor:pointer; padding:10px 12px; font-weight:900; list-style:none; display:flex; align-items:center; justify-content:space-between; gap:10px; }
    #matList summary::-webkit-details-marker{ display:none; }
    .matRows{ padding:10px 12px 12px; display:flex; flex-direction:column; gap:8px; }
    .matRow{
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px;
      background:linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      display:grid;
      grid-template-columns: 1fr 110px 90px 44px;
      gap:8px;
      align-items:center;
    }
    .matRow .matName{ font-weight:900; }
    .matRow input{ padding:8px 10px; border-radius:12px; }
    .matRow select{ padding:8px 10px; border-radius:12px; }
    .matRow .btn{ padding:8px 10px; border-radius:12px; }
    @media (max-width:820px){
      .matRow{ grid-template-columns: 1fr 110px 90px 44px; }
    }

  .isDisabled{ opacity:0.65; filter:saturate(0.85); }

  /* Modal (Import-Report / Fehlermeldungen) */
  .modalHost{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.55);
    display:none;
    align-items:center;
    justify-content:center;
    padding:14px;
    z-index:9999;
  }
  .modalCard{
    max-width:820px;
    width:100%;
    background:linear-gradient(180deg, rgba(31,42,61,.98), rgba(34,49,74,.96));
    border:1px solid var(--line);
    border-radius:18px;
    box-shadow:var(--shadow);
    padding:14px;
  }
  .modalTitle{ font-weight:950; font-size:16px; margin-bottom:8px; }
  .modalBody{ font-size:13px; color:rgba(226,232,240,.92); }
  .modalBody code{ background:rgba(255,255,255,.08); padding:1px 6px; border-radius:8px; }
  .modalBtns{ display:flex; gap:8px; justify-content:flex-end; flex-wrap:wrap; margin-top:12px; }
</style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="toprow">
        <div class="row">
          <div class="brand">Zaunteam Zaunplaner <small id="verPill" class="pill accent">v‚Äî</small></div>
          <span class="pill" id="statusPill">kein Projekt</span>
          <span class="pill" id="savePill">gespeichert: ‚Äî</span>
          <span class="pill" id="backupPill">Backup: ‚Äî</span>
          <span class="pill" id="projCountPill">0</span>
        </div>
        <div class="row">
          <button class="btn" id="btnBackup" type="button" title="Erzeugt eine Sicherungsdatei mit allen Kunden & Daten">üíæ Speichern (Datei)</button>
          <button class="btn small" id="btnDemo" type="button">Demo</button>
      <button id="btnImportJson" class="btn" type="button" title="L√§dt eine Sicherungsdatei (JSON) wieder ein">üìÇ Laden (Datei)</button>
      <input id="fileImportJson" type="file" accept="application/json,.json" style="display:none" />
          <button class="btn small" id="btnCSV" type="button">Material CSV</button>
          <button id="btnUpdate" class="btn" type="button">Update pr√ºfen</button>
      <button class="btn small bad" id="btnReset" type="button">Reset</button>
        </div>
      </div>

      <div class="tabs">
        <button class="tabBtn active" data-tab="kunde" type="button">üë§ Kunde / Projekt</button>
        <button class="tabBtn" data-tab="chef" type="button">üõ†Ô∏è Chef/Team</button>
        <button class="tabBtn" data-tab="settings" type="button">‚öôÔ∏è Einstellungen</button>
      </div>
    </div>

    <!-- KUNDE/PROJEKT (vereint) -->
    <section class="panel tab" data-tab="kunde">
      <div class="cardTitle">
        <h2>üë§ Kunden</h2>
        <span class="pill" id="projCountPill">0</span>
      </div>

      <!-- LIST VIEW -->
      <div id="kundenListView">
        <div class="card">
        <div class="row" style="margin-top:6px;">
          <div style="flex:1;">
            <label>Suche Kunde</label>
            <input id="projSearch" placeholder="z.B. M√ºller, Musterstra√üe‚Ä¶" />
          </div>
        </div>

        <details id="projOverviewDetails" style="margin-top:10px;">
          <summary style="cursor:pointer; user-select:none;">üìã Projekt√ºbersicht (Status / Stunden)</summary>
          <div id="projOverview" style="margin-top:8px;"></div>
        </details>

          <div class="row">
            <div style="flex:1;">
              <label>Kunde ausw√§hlen</label>
              <select id="projSel"></select>
            </div>
            <div style="display:flex; gap:8px; align-items:flex-end;">
              <button id="btnOpenCustomer" class="btn green" type="button">√ñffnen</button>
              <button id="btnAdd" class="btn dark" type="button">+ Neuer Kunde</button>
            </div>
          </div>

          <div class="row" style="margin-top:10px;">
            <div style="flex:1;">
              <label>Kundenname (f√ºr Neu)</label>
              <input id="pName" placeholder="Neuer Kunde" />
            </div>
          </div>

          <details style="margin-top:10px;">
            <summary style="cursor:pointer; font-weight:900;">Optionale Basisdaten (bei Neu)</summary>
            <div class="row" style="margin-top:10px;">
              <div style="flex:1;">
                <label>Erstellt (optional)</label>
                <input id="pCreated" type="date" />
              </div>
              <div style="flex:1;">
                <label>Ausf√ºhrung (optional)</label>
                <input id="pDate" type="date" />
              </div>
            </div>
            <div class="row" style="margin-top:10px;">
              <div style="flex:1;">
                <label>Telefon (optional)</label>
                <input id="pPhone" placeholder="+49..." />
              </div>
              <div style="flex:1;">
                <label>E‚ÄëMail (optional)</label>
                <input id="pEmail" placeholder="mail@..." />
              </div>
            </div>
            <div class="row" style="margin-top:10px;">
              <div style="flex:1;">
                <label>Adresse Kunde (optional)</label>
                <input id="pAddr" placeholder="Stra√üe, PLZ Ort" />
              </div>
              <div style="flex:1;">
                <label>Objektadresse (optional)</label>
                <input id="pObj" placeholder="falls abweichend" />
              </div>
            </div>
          </details>

          <div class="hint" style="margin-top:10px;">
            Tipp: W√§hle einen Kunden im Dropdown ‚Üí ‚Äû√ñffnen‚Äú. Im Bearbeiten‚ÄëModus wird automatisch gespeichert.
          </div>
        </div>

        <div id="projCards" style="display:none;"></div>
      </div>

      <!-- EDIT VIEW -->
      <div id="kundenEditView" style="display:none;">
        <div class="row" style="margin-bottom:10px;">
          <button id="btnBackToList" class="btn blue" type="button">‚Üê Zur√ºck zur Kundenliste</button>
        </div>


      <div class="cardTitle">
        <h2 id="kundeTitle">üë§ Kunde</h2>
        <span class="pill" id="kundePill">leer</span>
      </div>
      <div id="kundeKpi" class="row" style="margin-top:8px;"></div>
      <div class="card" style="margin-top:10px;">
        <div class="cardTitle"><h3>üè† Adresse Kunde</h3></div>
        <div class="grid3">
          <div style="grid-column: span 2;">
            <label>Stra√üe / Hausnr.</label>
            <input id="kStreet" placeholder="z.B. Hauptstra√üe 12" />
          </div>
          <div>
            <label>PLZ</label>
            <input id="kZip" inputmode="numeric" placeholder="z.B. 10115" />
            <div class="hint">Ort wird online automatisch erg√§nzt (sonst manuell).</div>
          </div>
          <div style="grid-column: span 2;">
            <label>Ort</label>
            <input id="kCity" placeholder="z.B. Berlin" />
          </div>
          <div>
            <label>Land (optional)</label>
            <input id="kCountry" placeholder="DE" />
          </div>
        </div>
        <div class="row" style="margin-top:8px;">
          <div style="flex:1;">
            <label>Objektadresse / Baustelle (optional)</label>
            <input id="kObjAddr" placeholder="falls abweichend" />
          </div>
        </div>
        <div class="hint" id="addrBar" style="margin-top:8px;">Adresse: ‚Äî</div>
      </div>


      <div class="grid3">
        
        <div>
          <label>Erstellt</label>
          <input id="kCreated" type="date" />
        </div>
        <div>
          <label>Ausf√ºhrung</label>
          <input id="kPlanned" type="date" />
        </div>
        <div>
          <label>Telefon</label>
          <input id="kPhone" inputmode="tel" />
        </div>
      </div>

      <div class="cardTitle" style="margin-top:8px;"><h3>üìá Kontakt</h3></div>
      <div class="grid2">
        <div>
          <label>E‚ÄëMail</label>
          <input id="kEmail" inputmode="email" />
        </div>
        <div style="opacity:.65; font-size:12px; padding-top:26px;">Zaun wird √ºber Abschnitte erfasst (A, B, C‚Ä¶)</div>
      </div>
      <input id="kLen" type="hidden" />

      <div id="customerFenceGlobalsTop" style="display:none;">
  <div class="grid3">
    <div>
      <label>H√∂he</label>
      <select id="kHeight"></select>
    </div>
    <div>
      <label>System</label>
      <select id="kSystem">
        <option>Doppelstab</option>
        <option>Holz</option>
        <option>WPC</option>
        <option>Aluminium</option>
        <option>Diagonalgeflecht</option>
        <option>Tornado</option>
        <option>Elektrozaun</option>
      </select>
    </div>
    <div>
      <label>Farbe</label>
      <select id="kColor"></select>
    </div>
  </div>
</div>

<div id="customerFenceGlobalsBottom" style="display:none;">
  <div class="grid2">
    <div>
      <label>Holzart</label>
      <select id="kWood"></select>
    </div>
    <div>
      <label>WPC Variante</label>
      <select id="kWpc"></select>
    </div>
  </div>
</div>

<div class="grid3" style="margin-top:10px;">
  <div>
    <label>Gef√§lle</label>
    <select id="kSlopeType">
      <option value="flat">kein</option>
      <option value="pct">%</option>
    </select>
  </div>

  <div class="card fullBleed" style="margin-top:0; grid-column:1 / -1;">
    <div class="cardTitle">
      <h3>üß© Zaunabschnitte (A, B, C‚Ä¶)</h3>
      <span class="pill">unterschiedliche H√∂hen & Systeme</span>
    </div>

    <div class="row" style="margin-top:8px; gap:8px; align-items:flex-end;">
      <div style="flex:0 0 140px;">
        <label>Neu</label>
        <select id="segAddLabel"></select>
      </div>
      <button id="btnSegAdd" class="btn green" type="button">+ Abschnitt</button>
      <button id="btnSegCollapseAll" class="btn" type="button">Alle schlie√üen</button>
      <button id="btnSegExpandAll" class="btn" type="button">Alle √∂ffnen</button>
    </div>

    <div id="segList" style="margin-top:10px;"></div>

    <div class="hint" style="margin-top:10px;">
      Tipp: L√§nge je Abschnitt eintragen. Gesamtl√§nge wird automatisch summiert.
    </div>
  </div>

  <div>
    <label>Gef√§lle %</label>
    <input id="kSlopePct" inputmode="decimal" placeholder="z. B. 2,5" />
  </div>
</div>

<!-- Eck-/Corner Eingabe au√üerhalb der Abschnitte (ausgeblendet, bleibt f√ºr Kompatibilit√§t) -->
<div style="display:none;">
  <label>Ecken</label>
  <div class="row">
    <button class="btn small" id="kCornersMinus" type="button">‚àí</button>
    <input id="kCorners" inputmode="numeric" value="0" style="max-width:140px;" />
    <button class="btn small" id="kCornersPlus" type="button">+</button>
  </div>
</div>

<div class="grid2">
        <div>
          <label>Beton‚ÄëModus</label>
          <select id="kConcreteMode">
            <option value="sacks">Sack (Auto)</option>
            <option value="m3">m¬≥ (Auto)</option>
          </select>
          <div class="hint" id="kConcreteAutoHint" style="margin-top:6px;"></div>
        </div>
        <div>
          <label>Beton (Auto)</label>
          <input id="kConcreteVal" />
        </div>
      </div>

      <div class="grid2">
        <div>
          <label>Sichtschutz?</label>
          <select id="kPrivacy">
            <option value="no">nein</option>
            <option value="yes">ja</option>
          </select>
        </div>
        <div>
          <label>Sichtschutz‚ÄëL√§nge (m)</label>
          <input id="kPrivacyLen" inputmode="decimal" placeholder="leer = ganze Zaunl√§nge" />
        </div>
      </div>
      <div class="grid2" id="privacyRollRow" style="margin-top:10px;">
        <div>
          <label>Rollen‚ÄëL√§nge</label>
          <select id="kPrivacyRoll">
            <option value="35">35 m</option>
            <option value="50">50 m</option>
          </select>
        </div>
        <div>
          <label>Sichtschutz‚ÄëRollen (Auto)</label>
          <input id="kPrivacyRollsAuto" disabled />
        </div>
      </div>

      <div class="card" style="margin-top:12px;">
        <div class="grid2">
          <div>
            <label>Tor‚ÄëTyp</label>
            <select id="kGateType">
              <option value="none">kein Tor</option>
              <option value="gate1">1‚Äëfl√ºgelig</option>
              <option value="gate2">2‚Äëfl√ºgelig</option>
              <option value="gate3">3‚Äëfl√ºgelig</option>
            </select>
          </div>
          <div class="row" style="align-self:end;">
            <button class="btn small" id="btnGateAdd" type="button">+ Tor</button>
            <button class="btn small bad" id="btnGateClear" type="button">Tore l√∂schen</button>
          </div>
        </div>
        <div id="gateVariants" class="hint" style="margin-top:10px;"></div>
        <div id="gateRows" style="margin-top:10px;"></div>
      </div>

      <label>Kunden‚ÄëNotiz</label>
      <textarea id="kNote" placeholder="Notizen‚Ä¶"></textarea>

      
</div>
<div class="row" style="margin-top:10px;">
<button class="btn blue" id="btnKDown" type="button">Kunden‚ÄëText Download</button>
        <button class="btn accent green" id="btnKWhats" type="button">WhatsApp Kunde</button>
        <button class="btn orange" id="btnKCall" type="button">üìû</button>
        <button class="btn purple" id="btnKMail" type="button">‚úâÔ∏è</button>
      </div>
    
      </div>
    </section>

    <!-- CHEF / TEAM -->
    <section class="panel tab" data-tab="chef" style="display:none;">
      <div class="cardTitle">
        <h2 id="chefTitle">üõ†Ô∏è Chef / Team</h2>
        <span class="pill" id="chefPill">leer</span>
      </div>

      <div class="grid3">
        <div>
          <label>Bagger</label>
          <select id="cBagger">
            <option value="no">nein</option>
            <option value="yes">ja</option>
          </select>
        </div>
        <div>
          <label>Ramme</label>
          <select id="cRamme">
            <option value="no">nein</option>
            <option value="yes">ja</option>
          </select>
        </div>
        <div>
          <label>H√§nger</label>
          <select id="cHaenger">
            <option value="no">nein</option>
            <option value="yes">ja</option>
          </select>
        </div>
      </div>

      <div class="grid2">
        <div>
          <label>Handbohrger√§t</label>
          <select id="cHandbohr">
            <option value="no">nein</option>
            <option value="yes">ja</option>
          </select>
        </div>
        <div>
          <label>Schubkarre</label>
          <select id="cSchubkarre">
            <option value="no">nein</option>
            <option value="yes">ja</option>
          </select>
        </div>
      </div>

      <div class="grid2" style="margin-top:10px;">
        <div>
          <label>Geplante Stunden</label>
          <input id="cHoursPlanned" inputmode="decimal" placeholder="z.B. 16" />
        </div>
        <div>
          <label>Status (optional)</label>
          <select id="cStatus">
            <option value="draft">Entwurf</option>
            <option value="planned">geplant</option>
            <option value="inwork">in Arbeit</option>
            <option value="done">fertig</option>
          </select>
        </div>
      </div>

      <label>Kunden‚ÄëNotiz (automatisch)</label>
      <textarea id="cCustomerNote" readonly placeholder="(wird aus dem Kunden‚ÄëTab √ºbernommen)"></textarea>

      <label>Team‚ÄëHinweise</label>
      <textarea id="cNote" placeholder="z. B. Zufahrt, Besonderheiten‚Ä¶"></textarea>

      <div class="card">
        <div class="cardTitle">
          <b>Interne Materialliste</b>
          <span class="pill" id="matPill">0</span>
        </div>

        <div class="grid3" style="margin-top:10px;">
          <div>
            <label>Material</label>
            <select id="mName">
              <optgroup label="Matten / Elemente">
                <option>Doppelstabmatte</option>
                <option>Diagonalgeflecht</option>
                <option>Tornado</option>
                <option>Elektrozaun</option>
              </optgroup>
              <optgroup label="Pfosten">
                <option>Pfosten</option>
                <option>Eckpfosten</option>
              </optgroup>
              <optgroup label="Leisten / Zubeh√∂r">
                <option>U-Leiste</option>
                <option>Torleiste</option>
                <option>Abdeckkappe</option>
              </optgroup>
              <optgroup label="Beton">
                <option>Beton (Sack)</option>
                <option>Fertigbeton (m¬≥)</option>
              </optgroup>
              <optgroup label="Sonstiges">
                <option value="__custom__">Sonstiges (Freitext)‚Ä¶</option>
              </optgroup>
            </select>
            <input id="mNameCustom" placeholder="Material frei eingeben‚Ä¶" style="display:none; margin-top:8px;" />
          </div>
          <div>
            <label>Menge</label>
            <input id="mQty" inputmode="decimal" />
          </div>
          <div>
            <label>Einheit</label>
            <select id="mUnit">
              <option>Stk</option>
              <option>m</option>
              <option>m¬≤</option>
              <option>Sack</option>
              <option>m¬≥</option>
              <option>Paket</option>
            </select>
          </div>
        </div>
<div class="row" style="margin-top:10px;">
          <button class="btn good" id="btnAddMat" type="button">+ hinzuf√ºgen</button>
          <button class="btn bad" id="btnClearMat" type="button">Liste leeren</button>
        </div>

        <div id="matList" style="margin-top:10px;"></div>
      </div>

      <div class="card">
        <div class="cardTitle">
          <b>Fotos</b>
          <span class="pill" id="photoPill">0</span>
        </div>
        <div class="hint" style="margin:8px 0 10px;">
          Desktop‚ÄëWhatsApp kann Fotos nicht automatisch anh√§ngen ‚Üí nutze ‚ÄûFotos.zip‚Äú.
        </div>
        <div id="photoGrid"></div>
      </div>

      <div class="row" style="margin-top:10px;">
        <button class="btn accent green" id="btnCWhatsText" type="button">Intern Text</button>
        <button class="btn accent green" id="btnCWhatsFotos" type="button">Intern Fotos</button>
        <button class="btn accent green" id="btnCWhats" type="button">Intern Alles</button>
        <button class="btn accent" id="btnCMaps" type="button">üìç Maps</button>
        <button class="btn blue" id="btnCDown" type="button">Intern‚ÄëText Download</button>
        <button class="btn blue" id="btnCZip" type="button">Fotos.zip</button>
        <button class="btn purple" id="btnCMail" type="button">E‚ÄëMail (Text)</button>
      </div>
    </section>

    <!-- SETTINGS -->
    <section class="panel tab" data-tab="settings" style="display:none;">
      <h2>‚öôÔ∏è Einstellungen & Backup</h2>

      <div class="card">
        <div class="cardTitle">
          <b>Speicher‚ÄëStatus</b>
          <span class="pill" id="storagePill">‚Äî</span>
        </div>
        <div id="storageStatusBox" class="hint" style="margin-top:10px;"></div>
        <div class="row" style="margin-top:10px;">
          <button class="btn small" id="btnStorageSelfTest" type="button">üîß Speicher testen</button>
          <button class="btn small" id="btnExportLog" type="button">üßæ Log exportieren</button>
        </div>
      </div>

      <div class="card">
        <div class="cardTitle"><b>Backup & Restore</b></div>
        <div class="hint" style="margin-top:6px;">
          Vollst√§ndig offline. Export passiert nur manuell. Import bietet <b>Merge</b> oder <b>Replace</b> + Report.
        </div>
        <div class="row" style="margin-top:10px;">
          <button class="btn green" id="btnExportJSON" type="button">üíæ JSON Backup</button>
          <button class="btn" id="btnImportJSON2" type="button">üìÇ JSON importieren</button>
          <button class="btn blue" id="btnExportCSVProjects" type="button">üìÑ CSV Kunden</button>
          <button class="btn blue" id="btnExportCSVAllMaterials" type="button">üìÑ CSV Gesamt‚ÄëMaterial</button>
          <button class="btn purple" id="btnExportPDF" type="button">üñ®Ô∏è PDF Report (Druck)</button>
        </div>
        <div class="hint" style="margin-top:8px;">
          Mobile: Wenn m√∂glich √∂ffnet sich direkt das Teilen‚ÄëMen√º. Dateiname enth√§lt Datum/Uhrzeit.
        </div>
      </div>

      <div class="card">
        <div class="cardTitle"><b>Export‚ÄëOptionen</b></div>
        <div class="grid2" style="margin-top:10px;">
          <div>
            <label><input id="setShareOnExport" type="checkbox" style="width:auto; margin-right:8px;" />Beim Export Teilen‚ÄëMen√º nutzen (wenn verf√ºgbar)</label>
            <div class="hint">Empfohlen f√ºr iPhone/Android. Fallback ist normaler Download.</div>
          </div>
          <div>
            <label><input id="setAutoBackupHint" type="checkbox" style="width:auto; margin-right:8px;" disabled />Erinnerung ‚ÄûBackup machen‚Äú (sp√§ter)</label>
            <div class="hint">Vorbereitet ‚Äì ohne Zwang & ohne Benachrichtigungen (noch deaktiviert).</div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="cardTitle"><b>Datenschutz</b></div>
        <div class="hint" style="margin-top:6px;">
          <b>Keine Accounts, kein Tracking, keine Werbung.</b><br>
          Alle Daten bleiben lokal auf deinem Ger√§t (Browser‚ÄëSpeicher).<br>
          Export/Teilen passiert nur, wenn du aktiv auf ‚ÄûExport‚Äú klickst.
        </div>
      </div>

      <div class="card">
        <div class="cardTitle"><b>Support</b></div>
        <div class="grid2" style="margin-top:10px;">
          <div>
            <label>Kontakt‚ÄëMail</label>
            <input id="setSupportEmail" placeholder="z.B. info@deinbetrieb.de" />
          </div>
          <div>
            <label>App‚ÄëInfo</label>
            <div id="supportInfo" class="hint" style="margin-top:6px;"></div>
          </div>
        </div>
        <div class="row" style="margin-top:10px;">
          <button class="btn small" id="btnSupportMail" type="button">‚úâÔ∏è Support‚ÄëMail √∂ffnen</button>
        </div>
      </div>
    </section>

  </div>

  <div id="updateBar" style="display:none; margin-top:10px;" class="card">
    <div class="row" style="align-items:center; justify-content:space-between;">
      <div style="font-weight:900;">üîÑ Update verf√ºgbar ‚Äì jetzt neu laden?</div>
      <button id="btnUpdateNow" class="btn green" type="button">Jetzt aktualisieren</button>
    </div>
    <div class="hint" style="margin-top:8px;">Hinweis: Deine Kunden bleiben erhalten.</div>
  </div>

  <div id="modalHost" class="modalHost"><div class="modalCard" id="modalCard"></div></div>

  <div id="toast"></div>

  <datalist id="gateWidthList">
    <option value="80"></option>
    <option value="100"></option>
    <option value="125"></option>
    <option value="150"></option>
    <option value="200"></option>
  </datalist>

  <script src="./app.js?v=1.4.46" defer></script>
  <!-- PWA Service Worker (Auto-Update, offline-ready) -->
  <script>
    (function(){
      const VER = "1.4.46";
      if (!('serviceWorker' in navigator)) return;
      window.addEventListener('load', async () => {
        const updateBar = document.getElementById('updateBar');
        const btnUpdateNow = document.getElementById('btnUpdateNow');
        const showUpdate = () => { if(updateBar) updateBar.style.display = 'block'; };
        try{
          // Cleanup: alte Versionen raus
          try{
            const regs = await navigator.serviceWorker.getRegistrations();
            for(const r of regs){
              const u = (r && r.active && r.active.scriptURL) ? r.active.scriptURL : '';
              if(u.includes('sw.js?v=') && !u.includes('sw.js?v='+VER)) await r.unregister();
            }
          }catch(_){ }

          const reg = await navigator.serviceWorker.register('./sw.js?v='+VER, { updateViaCache: 'none' });
          const doUpdate = () => reg && reg.update().catch(()=>{});
          doUpdate();
          setInterval(doUpdate, 10*60*1000);

          if(reg.waiting) showUpdate();
          reg.addEventListener('updatefound', () => {
            const sw = reg.installing;
            if(!sw) return;
            sw.addEventListener('statechange', () => {
              if(sw.state==='installed' && navigator.serviceWorker.controller) showUpdate();
            });
          });

          if(btnUpdateNow){
            btnUpdateNow.addEventListener('click', () => {
              try{ if(reg.waiting) reg.waiting.postMessage({type:'SKIP_WAITING'}); }catch(_){ }
              setTimeout(()=>location.reload(), 200);
            });
          }

          navigator.serviceWorker.addEventListener('controllerchange', () => location.reload());
        }catch(e){
          console.warn('SW register failed', e);
        }
      });
    })();
  </script>
</body>
</html>
